<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cambiar Estado de Propietario</title>
    <script src="vistaWeb.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 20px auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      .container {
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      }
      .header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 10px;
        padding-bottom: 15px;
        border-bottom: 3px solid #667eea;
      }
      .header-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
        font-weight: bold;
      }
      h1 {
        color: #2d3748;
        font-size: 24px;
        margin: 0;
      }
      .subtitle {
        color: #718096;
        font-size: 14px;
        margin: 10px 0 25px 0;
      }
      .section {
        margin: 25px 0;
      }
      .section-title {
        font-size: 14px;
        font-weight: 600;
        color: #4a5568;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .form-group {
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #4a5568;
        font-size: 14px;
      }
      input,
      select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.3s ease;
        box-sizing: border-box;
      }
      input:focus,
      select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }
      button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        width: 100%;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }
      button:active {
        transform: translateY(0);
      }
      .info-box {
        display: none;
        padding: 20px;
        background: linear-gradient(135deg, #e0e7ff 0%, #f3e8ff 100%);
        border: 2px solid #a78bfa;
        border-radius: 12px;
        margin-top: 20px;
      }
      .info-box.show {
        display: block;
        animation: slideIn 0.3s ease-out;
      }
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .info-header {
        font-weight: 700;
        color: #5b21b6;
        margin-bottom: 15px;
        font-size: 16px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .info-item {
        margin: 10px 0;
        padding: 10px;
        background: white;
        border-radius: 6px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .info-label {
        font-weight: 600;
        color: #6b7280;
        font-size: 13px;
      }
      .info-value {
        color: #1f2937;
        font-weight: 500;
      }
      .estado-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
      }
      .estado-habilitado {
        background: #d1fae5;
        color: #065f46;
      }
      .estado-deshabilitado {
        background: #fee2e2;
        color: #991b1b;
      }
      .estado-suspendido {
        background: #fef3c7;
        color: #92400e;
      }
      .estado-penalizado {
        background: #fecaca;
        color: #7f1d1d;
      }
      .message {
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        font-weight: 500;
        animation: slideIn 0.3s ease-out;
      }
      .success {
        background: #d1fae5;
        color: #065f46;
        border: 2px solid #6ee7b7;
      }
      .note {
        font-size: 12px;
        color: #6b7280;
        font-style: italic;
        margin-top: 8px;
      }
      footer {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #e2e8f0;
        color: #9ca3af;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="header-icon">üîÑ</div>
        <h1>Cambiar estado de propietario</h1>
      </div>
      <p class="subtitle">
        Ingresa la c√©dula, revise el estado actual y seleccione un nuevo estado
        (datos de ejemplo).
      </p>

      <!-- Secci√≥n: Buscar Propietario -->
      <div class="section">
        <div class="section-title">C√©dula de identidad</div>
        <form id="formBuscar">
          <div class="form-group">
            <input
              type="text"
              name="cedula"
              id="cedula"
              placeholder="12345678"
              required
            />
          </div>
          <button type="submit">Buscar</button>
        </form>
      </div>

      <!-- Informaci√≥n del Propietario -->
      <div id="infoPropietario" class="info-box">
        <div class="info-header">Propietario</div>
        <div class="info-item">
          <span class="info-label">Nombre</span>
          <span class="info-value" id="propNombre"></span>
        </div>
        <div class="info-item">
          <span class="info-label">Estado actual</span>
          <span class="info-value" id="propEstadoContainer"></span>
        </div>
      </div>

      <!-- Secci√≥n: Cambiar Estado -->
      <div id="seccionCambiarEstado" style="display: none">
        <div class="section">
          <div class="section-title">Estados definidos</div>
          <form id="formCambiar">
            <div class="form-group">
              <select name="posNuevoEstado" id="selectEstado" required>
                <option value="-1" selected disabled>
                  Seleccione un nuevo estado...
                </option>
              </select>
              <p class="note">El estado actual se mostrar√° preseleccionado.</p>
            </div>
            <button type="submit">Cambiar estado</button>
          </form>
          <div id="mensajeResultado"></div>
        </div>
      </div>

      <footer>¬© 2025 ‚Äî Administraci√≥n</footer>
    </div>

    <script src="utilesVista.js"></script>
    <script>
      // Configurar inicializaci√≥n de vista
      urlIniciarVista = "/cambiarEstado/vistaConectada";
      parametrosInicioVista = "";

      let propietarioActual = null;
      let estadosDisponibles = [];

      // Funci√≥n para obtener clase CSS seg√∫n el estado
      function getEstadoClass(estado) {
        const estadoLower = estado.toLowerCase();
        if (estadoLower.includes("habilitado")) return "estado-habilitado";
        if (estadoLower.includes("deshabilitado"))
          return "estado-deshabilitado";
        if (estadoLower.includes("suspendido")) return "estado-suspendido";
        if (estadoLower.includes("penalizado")) return "estado-penalizado";
        return "";
      }

      // Funciones para procesar respuestas del servidor
      function mostrar_estados(data) {
        estadosDisponibles = data;
        const select = document.getElementById("selectEstado");

        // Limpiar opciones existentes excepto la primera
        select.innerHTML =
          '<option value="-1" selected disabled>Seleccione un nuevo estado...</option>';

        // Agregar estados
        data.forEach((estado, index) => {
          const option = document.createElement("option");
          option.value = index;
          option.textContent = estado;
          select.appendChild(option);
        });
      }

      function mostrar_propietario(data) {
        propietarioActual = data;

        // Mostrar informaci√≥n del propietario
        document.getElementById("propNombre").textContent = data.nombreCompleto;

        // Mostrar estado con badge
        const estadoContainer = document.getElementById("propEstadoContainer");
        const estadoClass = getEstadoClass(data.estado);
        estadoContainer.innerHTML = `<span class="estado-badge ${estadoClass}">${data.estado}</span>`;

        document.getElementById("infoPropietario").classList.add("show");

        // Mostrar secci√≥n de cambiar estado
        document.getElementById("seccionCambiarEstado").style.display = "block";

        // Preseleccionar el estado actual en el dropdown
        const select = document.getElementById("selectEstado");
        for (let i = 0; i < select.options.length; i++) {
          if (select.options[i].text === data.estado) {
            select.selectedIndex = i;
            break;
          }
        }

        // Limpiar mensaje anterior
        document.getElementById("mensajeResultado").innerHTML = "";
      }

      function mostrar_mensaje(texto) {
        document.getElementById("mensajeResultado").innerHTML =
          '<div class="message success">‚úì ' + texto + "</div>";
      }

      function excepcionDeAplicacion(mensaje) {
        alert("‚ùå Error: " + mensaje);
      }

      // Manejo de formularios
      document
        .getElementById("formBuscar")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const params = serializarFormulario("formBuscar");
          submit("/cambiarEstado/buscarPropietarioPorCedula", params);
        });

      document
        .getElementById("formCambiar")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          if (!propietarioActual) {
            alert("‚ùå Primero debe buscar un propietario");
            return;
          }

          const posNuevoEstado = document.getElementById("selectEstado").value;

          if (posNuevoEstado === "-1") {
            alert("‚ùå Debe seleccionar un estado");
            return;
          }

          const nuevoEstado = estadosDisponibles[posNuevoEstado];

          // Confirmar cambio
          const confirmar = await mostrarConfirmacion(
            `¬øEst√° seguro de cambiar el estado de ${propietarioActual.nombreCompleto} a ${nuevoEstado}?`,
            "S√≠, cambiar",
            "Cancelar"
          );

          if (!confirmar) return;

          const params =
            "cedula=" +
            encodeURIComponent(propietarioActual.cedula) +
            "&posNuevoEstado=" +
            posNuevoEstado;
          submit("/cambiarEstado/cambiarEstado", params);
        });
    </script>
  </body>
</html>
